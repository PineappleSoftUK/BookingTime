//Returns the current time of the object as a string
class TimeString extends Date {

  //Function to add leading zero's
  pad(num, size) {
    var s = "000000000" + num;
    return s.substr(s.length - size);
  }

  //Function to return the current time of the date object as a string
  timeAsString() {
    var time;
    time = this.pad(this.getHours(), 2) + ":" + this.pad(this.getMinutes(), 2);
    return time;
  }
}


//Removes any checkboxes generated by js from the form
function removeTimeslots() {

  //Find any element with the attribute: name="timeslot"
  var timeSlotElements = document.querySelectorAll('[name="timeslot"],[name="timeslot[]"]');

  //Loop through and remove the element
  for (var i = 0; i < timeSlotElements.length; i++) {
    timeSlotElements[i].remove();
  }
}


//Mask timeslot selection when 'All Day' is checked
function allDay() {

  //First remove any checkboxes generated by js from the form
  removeTimeslots();

  //Disable the input and button
  if (document.getElementById("daily").checked) {
    document.getElementById("timeslotFrequency").disabled = true;
    document.getElementById("showTimeslotsButton").disabled = true;
  } else {
    document.getElementById("timeslotFrequency").disabled = false;
    document.getElementById("showTimeslotsButton").disabled = false;
  }

}

//Add checkboxes to form based on number selected
function showTimeslots() {

  //First remove any checkboxes generated by js from the form
  removeTimeslots();

  //The form
  var form = document.getElementById("form");
  var submitButton = document.getElementById("submitBreak");

  //Set the clock to zero
  var clock = new TimeString();
  clock.setHours(0, 0, 0);

  //Get text box value then calculate number of timeslots for the day
  var selection = parseInt(document.getElementById("timeslotFrequency").value);
  var numberOfTimeslots = 1440 / selection;

  //Add the checkboxes to the form
  for (i = 0; i < numberOfTimeslots; i++) {

  	//Get the time for checkbox
    var checkboxTime = clock.timeAsString();

    //Start with a br
    var brElement = document.createElement("br");
    brElement.setAttribute("name", "timeslot");
    submitButton.before(form.appendChild(brElement));

    //The checkbox
    var inputElement = document.createElement("input");
    inputElement.type = "checkbox";
    inputElement.name = "timeslot[]";
    inputElement.value = checkboxTime;
    submitButton.before(form.appendChild(inputElement));

    //The checkbox label
    var labelElement = document.createElement("LABEL");
    var labelText = document.createTextNode(checkboxTime);
    labelElement.setAttribute("for", "timeslot");
    labelElement.setAttribute("name", "timeslot");
    labelElement.appendChild(labelText);
    submitButton.before(form.appendChild(labelElement));

    //Increment the clock by the timeslot duration
    clock.setMinutes(clock.getMinutes() + selection);
  }

}
